# 重点协议3. HTTP

## 1.HTTP简介

* HTTP协议（HyperText Transfer Protocol，**超文本传输协议**）是因特网上应用最为广泛的一种网络传输协议，所有的WWW文件都必须遵守这个标准。

* HTTP是一个基于TCP/IP通信协议来传递数据（HTML 文件, 图片文件, 查询结果等）。HTTP协议通常承载于TCP协议之上，有时也承载于TLS或SSL协议层之上，这个时候，就成了我们常说的HTTPS。

  ![image-20200429203603077](C:\Users\apple\AppData\Roaming\Typora\typora-user-images\image-20200429203603077.png)

* HTTP是一个**应用层协议**，由请求和响应构成，是一个标准的客户端服务器模型。HTTP是一个**无状态**的协议。

* HTTP默认的端口号为**80**，HTTPS的端口号为**443**。

## 2. HTTP注意事项

1. HTTP是无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
2. HTTP是无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。
3. HTTP是媒体独立的：这意味着，只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过HTTP发送。客户端以及服务器指定使用适合的MIME-type内容类型。

## 3. HTTP消息结构(Request,Response)

#### 3.1客户端请求消息(Request)

* **客户端发送一个HTTP请求到服务器的请求消息包括以下格式：请求行（request line）、请求头部（header）、空行和请求数据**

  * 请求行：用来说明**请求类型**,要**访问的资源**以及所使用的**HTTP版本**.
  * 请求头：接着请求行（即第一行）之后的部分，用来说明服务器要使用的附加信息
  * 空行：个人认为是用来划分请求头与请求数据的
  * 请求数据：请求数据也叫主体，可以添加任意的其他数据，网络传输的数据。

  ![image-20200429204635261](C:\Users\apple\AppData\Roaming\Typora\typora-user-images\image-20200429204635261.png)

#### 3.2 服务端响应消息(Response)

* 服务器接收并处理客户端发过来的请求后会返回一个HTTP的响应消息。HTTP响应也由四个部分组成，分别是：**状态行**、**消息报头**、**空行**和**响应正文**。

  * 状态行：由**HTTP协议版本号**， **状态码**， **状态消息** 三部分组成。
  * 消息报文：用来说明客户端要使用的一些附加信息
  * 空行：个人认为是用来划分响应头与响应数据的
  * 响应报文：服务器返回给客户端的文本信息

  ![image-20200429204854687](C:\Users\apple\AppData\Roaming\Typora\typora-user-images\image-20200429204854687.png)

## 4.HTTP请求方法

* HTTP 请求可以使用多种请求方法。HTTP1.0 定义了三种请求方法： GET, POST 和 HEAD方法。HTTP1.1 新增了六种请求方法：OPTIONS、PUT、PATCH、DELETE、TRACE 和 CONNECT 方法。

| 序号 | 方法    | 描述                                                         |
| :--- | :------ | :----------------------------------------------------------- |
| 1    | GET     | 请求指定的页面信息，并返回实体主体。                         |
| 2    | HEAD    | 类似于 GET 请求，只不过返回的响应中没有具体的内容，用于获取报头 |
| 3    | POST    | 向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST 请求可能会导致新的资源的建立和/或已有资源的修改。 |
| 4    | PUT     | 从客户端向服务器传送的数据取代指定的文档的内容。             |
| 5    | DELETE  | 请求服务器删除指定的页面。                                   |
| 6    | CONNECT | HTTP/1.1 协议中预留给能够将连接改为管道方式的代理服务器。    |
| 7    | OPTIONS | 允许客户端查看服务器的性能。                                 |
| 8    | TRACE   | 回显服务器收到的请求，主要用于测试或诊断。                   |
| 9    | PATCH   | 是对 PUT 方法的补充，用来对已知资源进行局部更新 。           |

* **下面主要说说get和post的区别：**

  |                  | GET                                                     | POST                                                         |
  | ---------------- | ------------------------------------------------------- | ------------------------------------------------------------ |
  | 后退按钮/刷新    | 无害                                                    | 数据会被重新提交                                             |
  | 书签             | 可收藏为书签                                            | 不可收藏为书签                                               |
  | 缓存             | 能被缓存                                                | 不能缓存                                                     |
  | 编码类型         | application/x-www-form-urlencoded                       | application/x-www-form-urlencoded或multipart/form-data。为二进制数据使用多重编码 |
  | 历史             | 参数保留在浏览器历史中                                  | 参数不会保留在浏览器历史中                                   |
  | 对数据长度的限制 | 当发送数据时，GET方法向URL添加数据，URL最大长度2048字节 | 无限制                                                       |
  | 对数据类型的限制 | 只允许ASCLL字符                                         | 没有限制。也允许二进制数据                                   |
  | 安全性           | 与POST相比，GET的安全性较差，因为请求数据都在URL中      | 安全，因为请求参数不在URL也不会保存在浏览器历史或web服务器日志中 |
  | 可见性           | 数据在URL中对所有人可见                                 | 数据不会显示在URL中，自然也不可见                            |

## 5.HTTP常见Header

* Content-Type：数据类型(text/html等) ---->告诉对端，接收数据的类型，对端应该按照对应的格式处理数据
* Content-Length：告诉对端，请求体/响应体的长度
* Host：客户端告诉服务器，所请求的资源是在哪个主机的哪个端口上
* User-Agent：声明用户的操作系统和浏览器版本信息
* referer：当前页面是从哪个页面跳转过来的
* location：搭配3xx状态码使用，告诉客户端接下来要去哪里访问
* Cookie：用于在客户端存储少量信息，通常用于实现会话(session)功能
* Set-Cookie：用于响应头，要把Cookie保存在本地浏览器的文件中

## 6.HTTP状态码

* 最常见的状态码：

  * 200 - 请求成功
  * 301 - 资源（网页等）被永久转移到其它URL
  * 404 - 请求的资源（网页等）不存在
  * 500 - 内部服务器错误

* | 分类 | 分类描述                                       |
  | :--- | :--------------------------------------------- |
  | 1**  | 信息，服务器收到请求，需要请求者继续执行操作   |
  | 2**  | 成功，操作被成功接收并处理                     |
  | 3**  | 重定向，需要进一步的操作以完成请求             |
  | 4**  | 客户端错误，请求包含语法错误或无法完成请求     |
  | 5**  | 服务器错误，服务器在处理请求的过程中发生了错误 |

* | 状态码 | 状态码英文名称                  | 中文描述                                                     |
  | :----- | :------------------------------ | :----------------------------------------------------------- |
  | 100    | Continue                        | 继续。[客户端](http://www.dreamdu.com/webbuild/client_vs_server/)应继续其请求 |
  | 101    | Switching Protocols             | 切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议，例如，切换到HTTP的新版本协议 |
  |        |                                 |                                                              |
  | 200    | OK                              | 请求成功。一般用于GET与POST请求                              |
  | 201    | Created                         | 已创建。成功请求并创建了新的资源                             |
  | 202    | Accepted                        | 已接受。已经接受请求，但未处理完成                           |
  | 203    | Non-Authoritative Information   | 非授权信息。请求成功。但返回的meta信息不在原始的服务器，而是一个副本 |
  | 204    | No Content                      | 无内容。服务器成功处理，但未返回内容。在未更新网页的情况下，可确保浏览器继续显示当前文档 |
  | 205    | Reset Content                   | 重置内容。服务器处理成功，用户终端（例如：浏览器）应重置文档视图。可通过此返回码清除浏览器的表单域 |
  | 206    | Partial Content                 | 部分内容。服务器成功处理了部分GET请求                        |
  |        |                                 |                                                              |
  | 300    | Multiple Choices                | 多种选择。请求的资源可包括多个位置，相应可返回一个资源特征与地址的列表用于用户终端（例如：浏览器）选择 |
  | 301    | Moved Permanently               | 永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替 |
  | 302    | Found                           | 临时移动。与301类似。但资源只是临时被移动。客户端应继续使用原有URI |
  | 303    | See Other                       | 查看其它地址。与301类似。使用GET和POST请求查看               |
  | 304    | Not Modified                    | 未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源 |
  | 305    | Use Proxy                       | 使用代理。所请求的资源必须通过代理访问                       |
  | 306    | Unused                          | 已经被废弃的HTTP状态码                                       |
  | 307    | Temporary Redirect              | 临时重定向。与302类似。使用GET请求重定向                     |
  |        |                                 |                                                              |
  | 400    | Bad Request                     | 客户端请求的语法错误，服务器无法理解                         |
  | 401    | Unauthorized                    | 请求要求用户的身份认证                                       |
  | 402    | Payment Required                | 保留，将来使用                                               |
  | 403    | Forbidden                       | 服务器理解请求客户端的请求，但是拒绝执行此请求               |
  | 404    | Not Found                       | 服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置"您所请求的资源无法找到"的个性页面 |
  | 405    | Method Not Allowed              | 客户端请求中的方法被禁止                                     |
  | 406    | Not Acceptable                  | 服务器无法根据客户端请求的内容特性完成请求                   |
  | 407    | Proxy Authentication Required   | 请求要求代理的身份认证，与401类似，但请求者应当使用代理进行授权 |
  | 408    | Request Time-out                | 服务器等待客户端发送的请求时间过长，超时                     |
  | 409    | Conflict                        | 服务器完成客户端的 PUT 请求时可能返回此代码，服务器处理请求时发生了冲突 |
  | 410    | Gone                            | 客户端请求的资源已经不存在。410不同于404，如果资源以前有现在被永久删除了可使用410代码，网站设计人员可通过301代码指定资源的新位置 |
  | 411    | Length Required                 | 服务器无法处理客户端发送的不带Content-Length的请求信息       |
  | 412    | Precondition Failed             | 客户端请求信息的先决条件错误                                 |
  | 413    | Request Entity Too Large        | 由于请求的实体过大，服务器无法处理，因此拒绝请求。为防止客户端的连续请求，服务器可能会关闭连接。如果只是服务器暂时无法处理，则会包含一个Retry-After的响应信息 |
  | 414    | Request-URI Too Large           | 请求的URI过长（URI通常为网址），服务器无法处理               |
  | 415    | Unsupported Media Type          | 服务器无法处理请求附带的媒体格式                             |
  | 416    | Requested range not satisfiable | 客户端请求的范围无效                                         |
  | 417    | Expectation Failed              | 服务器无法满足Expect的请求头信息                             |
  |        |                                 |                                                              |
  | 500    | Internal Server Error           | 服务器内部错误，无法完成请求                                 |
  | 501    | Not Implemented                 | 服务器不支持请求的功能，无法完成请求                         |
  | 502    | Bad Gateway                     | 作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应 |
  | 503    | Service Unavailable             | 由于超载或系统维护，服务器暂时的无法处理客户端的请求。延时的长度可包含在服务器的Retry-After头信息中 |
  | 504    | Gateway Time-out                | 充当网关或代理的服务器，未及时从远端服务器获取请求           |
  | 505    | HTTP Version not supported      | 服务器不支持请求的HTTP协议的版本，无法完成处理               |



## 7.HTTP content-type

* Content-Type（内容类型），一般是指网页中存在的 Content-Type，用于定义网络文件的类型和网页的编码，决定浏览器将以什么形式、什么编码读取这个文件，Content-Type 标头告诉客户端实际返回的内容的内容类型。

* 语法格式：

  ```
  Content-Type: text/html; charset=utf-8
  Content-Type: multipart/form-data; boundary=something
  ```

* 常见的媒体格式类型如下：

  - text/html ： HTML格式
  - text/plain ：纯文本格式
  - text/xml ： XML格式
  - image/gif ：gif图片格式
  - image/jpeg ：jpg图片格式
  - image/png：png图片格式