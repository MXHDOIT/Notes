# 单例模式

### 1.什么是单例模式？

* 一个类中能创建一个实例，所以称之为单例

### 2.为什么要用单例模式？

* 那我们想想既然一个类中只能创建一个实例了，那么可以说这是跟**类的状态与对象无关**的了
* **频繁创建对象、管理对象是一件耗费资源的事**，我们只需要创建一个对象来用就足够了
* 什么地方用到了单例？
  1. Servlet
  2. SpringMVC

### 3.代码实现：

* 实质单例模式代码就三步而已：
  1. 将构造函数私有化
  2. 在类的内部创建实例
  3. 提供获取唯一实例的方法

1. 饿汉式：

   ```java
   public class Singleton {
       private static Singleton singleton = new Singleton();
   
       private Singleton(){
   
       }
       public static Singleton getInstance(){
           return singleton;
       }
   }
   ```

   缺点：一上来就创建对象了，**如果该实例从始至终都没被使用过，则会造成内存浪费**

2. 懒汉式：单线程版

   ```java
   public class Singleton_1 {
       private static Singleton_1 singleton_1;
   
       private Singleton_1(){
   
       }
   
       public static Singleton_1 getInstance(){
           if(null == singleton_1){
               singleton_1 = new Singleton_1();
           }
           return singleton_1;
       }
   }
   
   ```

   缺点：不支持多线程环境

3. 懒汉式：多线程版

   ```java
   public class Singletion_2 {
       private static Singletion_2 singletion_2;
   
       private Singletion_2(){
   
       }
   
       public synchronized static Singletion_2 getInstance(){
           if(null == singletion_2){
               singletion_2 = new Singletion_2();
           }
           return singletion_2;
       }
   }
   ```

   缺点：直接在方法上加锁的方式其实不够好，因为在**方法上加了内置锁**在多线程环境下性能会比较低下

4. 懒汉式 双重校验锁

   * 学习目标：

     * 掌握双重校验锁的写法
     * 掌握每行代码的作用以及内部原理
       * volatile关键字修饰变量
       * 私有构造方法
       * 双重校验锁的写法保证线程安全

   * 代码：

     ```java
     public class Sington{
         public  static volatile Sington SINGTON; //保证变量的可见性与重排序
         
         private Sington(){
         }
         
         public static Sington getInstance(){
             if(null == SINGTON){ //提高效率
                 synchronized(Sington.class){ //同步互斥下：保证原子性，可见性，与重排序
                     if(null == SINGTON){//为了保证单例，确保返回同意对象
                         SINGTON = new Sington();
                         //new对象分解三条指令：前两个指令是new，第三个是 =
                         //1.分配内存空间
                         //2.初始化对象
                         //3.赋值给变量
                         //使用volation为了确保不重排序
                     }
                 }
             }
             return SINGTON;
         }
     }
     ```

     