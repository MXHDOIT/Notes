# 程序计数器

* 定义：当前线程所执行的字节码的行号指示器

* 作用：实现异常处理，线程恢复等基础功能

* 原理：通过改变计数器的值来选取下一条执行的字节码指令

* 特点：

  * 线程私有
  * 内存空间小
  * 它是唯一一个在java虚拟机规范中**没有规定任何OOM（Out Of Memery）情况**的区域,而且没有垃圾回收

* 抛出的异常：无

* 代码示例：

  ![image-20200421164627082](C:\Users\apple\AppData\Roaming\Typora\typora-user-images\image-20200421164627082.png)

* 说明：

  * 线程私有的内存区域：为了使得线程切换后恢复到正确的执行位置，每条线程都配有一个独立的程序计数器，各线程互不影响，独立存储的内存区域

* **面试题：**

  1. **使用PC寄存器存储字节码指令地址有什么用呢（为什么使用PC寄存器记录当前线程的执行地址呢）**

     1. 多线程宏观上是并行（多个事件在同一时刻同时发生）的，但实际上是并发交替执行的

     2. 因为CPU需要不停的切换各个线程，这时候切换回来以后，就得知道接着从哪开始继续执行

     3. JVM的字节码解释器就需要通过改变PC寄存器的值来明确下一条应该执行什么样的字节码指令

        所以，众多线程在并发执行过程中，任何一个确定的时刻，一个处理器或者多核处理器中的一个内核，只会执行某个线程中的一条指令。这样必然导致经常中断或恢复，如何保证分毫无差呢？每个线程在创建后，都会产生自己的程序计数器和栈帧，程序计数器在各个线程之间互不影响。

  2. **PC寄存器为什么会设定为线程私有？**
     （1）我们都知道所谓的多线程在一个特定的时间段内只会执行其中某一个线程的方法，CPU会不停滴做任务切换，这样必然会导致经常中断或恢复，如何保证分毫无差呢？

     （2）为了能够准确地记录各个线程正在执行的当前字节码指令地址，最好的办法自然是**为每一个线程都分配一个PC寄存器,**这样一来各个线程之间便可以进行独立计算，从而不会出现相互干扰的情况。