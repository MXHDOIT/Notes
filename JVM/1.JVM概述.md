# 1.JVM概述：

### 基础知识：

1. 栈管运行，堆管存储  
2. java：跨平台的语言
3. jvm：跨语言的平台
4. jdk：java开发工具包，是程序员使用java语言编写java程序所需的开发工具包，是提供给程序员使用的。JDK包含了JRE，同时还包含了编译java源码的编译器javac，还包含了很多java程序调试和分析的工具：jconsole，jvisualvm等工具软件，还包含了java程序编写所需的文档和demo例子程序。
5. jre：Java运行时环境，包含了java虚拟机，java基础类库。是使用java语言编写的程序运行所需要的软件环境，是提供给想运行java程序的用户使用的，还有所有的Java类库的class文件，都在lib目录下，并且都打包成了jar。
6. 字节码：编译生成的，jvm字节码
7. 多语言混合编程
8. jdk 1.5添加很多新特性

<hr />

## 虚拟机与Java虚拟机

1. 虚拟机：就是虚拟的计算机，它是一款软件。
   1. 系统虚拟机：可运行完整操作系统的软件平台，模拟硬件
   2. 程序虚拟机：执行的指令，为程序设计，模拟运行环境
2. Java虚拟机：
   1. 概念：就是二进制字节码的运行环境，负责装载字节码到内存，解释/编译为对应平台上的机器指令执行。每一条Java指令，Java虚拟机规范中都有详细定义，如怎样取操作数，怎样处理操作数，处理结果放在那里。
   2. 特点：
      1. 一次编译，到处运行
      2. 自动内存管理
      3. 自动垃圾回收功能
3. JVM运作操作系统上，没有与硬件直接交互。

<hr />

## JVM体系结构

​	![image-20200410191556538](https://raw.githubusercontent.com/MXHDOIT/picBed/master/img/image-20200410191556538.png)

1. 多线程共享方法区和堆， 栈和本地方法栈和程序计数器是每个线程独有一份的

2. 字节码不等同于机器语言，需要借助执行引擎翻译为机器语言

3. Java栈又称JVM虚拟机栈

4. Java代码执行流程：

   Java程序 --(编译javac)-->字节码文件.class --> 类装载子系统化身为反射类Class--->运行时数据区--->（解释执行）-->操作系统（Win，Linux，Mac JVM）

<hr />

## JVM的架构模型

* 由于跨平台的设计，java的指令都是根据栈来设计的，不同平台CPU架构不同，所以不能设计为基于寄存器的
* 二者区别：
  * 栈：跨平台性，指令**集**小，指令多；执行性比寄存器差。
  * 寄存器：指令少
* ![image-20200410220311156](https://raw.githubusercontent.com/MXHDOIT/picBed/master/img/image-20200410220311156.png)

<hr />

## JVM的声明周期

1. **启动**：通过引导类加载器（bootstrap class loader）创建一个初始类（initial class）来完成的，这个类是由虚拟机的具体实现指定的.
2. **执行**：
   * 一个运行中的java虚拟机有着一个清晰的任务：执行Java程序；
   * 程序开始执行的时候他才运行，程序结束时他就停止；
   * 执行一个所谓的Java程序的时候，真真正正在执行的是一个叫做Java虚拟机的进程。
3. **退出：**
   * 程序正常执行结束
   * 程序异常或错误而异常终止
   * 操作系统错误导致终止
   * 某线程调用Runtime类或System类的exit方法，或Runtime类的halt方法，并且java安全管理器也允许这次exit或halt操作
   * 除此之外，JNI规范描述了用JNI Invocation API来加载或卸载Java虚拟机时，Java虚拟机的退出情况